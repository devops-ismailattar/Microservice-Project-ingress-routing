name: cicd-pipeline-for-nodejs
on: push
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: checkout
              uses: actions/checkout@v6.0.1
            - name: set up nodejs
              uses: actions/setup-node@v6.1.0
              with:
                node-version: 24
            - name: install dependecies
              run: |
                cd app1/cart-app && npm install && ls -l
                cd ../../app2/login-app && npm install && ls -l
                cd ../../app3/payment-app && npm install && ls -l

            - name: sonarqube scan
              uses: SonarSource/sonarqube-scan-action@v7.0.0
              env:
                SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
                SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}

            - name: sonarqube quality gate check
              uses: SonarSource/sonarqube-quality-gate-action@v1.2.0
              id: sonarqube-quality-gate-check
              with:
                pollingTimeoutSec: 600
              env:
                SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
                SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
            - name: upload artifact
              uses: actions/upload-artifact@v6.0.0
              with:
                name: cart-app
                path: app1/cart-app/package*.json

            - name: upload artifact
              uses: actions/upload-artifact@v6.0.0
              with:
                name: login-app
                path: app2/login-app/package*.json
            - name: upload artifact
              uses: actions/upload-artifact@v6.0.0
              with:
                name: payment-app
                path: app3/payment-app/package*.json

    build-and-push-docker-image:
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: checkout
              uses: actions/checkout@v6.0.1
            - name: dowload artifact
              uses: actions/download-artifact@v7.0.0
              with:
                name: cart-app
                path: app1/cart-app/
            - run: |
                ls -l app1/cart-app

            - name: dowload artifact
              uses: actions/download-artifact@v7.0.0
              with:
                name: login-app
                path: app2/login-app/
            - run: |
                ls -l app2/login-app/
            - name: dowload artifact
              uses: actions/download-artifact@v7.0.0
              with:
                name: payment-app
                path: app3/payment-app/
            - run: |
                ls -l app3/payment-app




        
            

                
                


